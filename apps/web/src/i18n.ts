export type Lang = "ru" | "en";

export type TranslateFn = (key: string) => string;

export const LOCALE_BY_LANG: Record<Lang, string> = {
  ru: "ru-RU",
  en: "en-US"
};

export const LANGUAGE_OPTIONS: Array<{ value: Lang; label: string }> = [
  { value: "ru", label: "RU" },
  { value: "en", label: "EN" }
];

const TEXT_BASE: Record<Lang, Record<string, string>> = {
  ru: {
    "app.title": "Boltorezka",
    "server.menuAria": "Меню сервера",
    "server.title": "Профиль сервера",
    "server.tabUsers": "Управление пользователями",
    "server.tabEvents": "Лог",
    "server.tabTelemetry": "Телеметрия",
    "server.tabCall": "Сигналинг",
    "auth.login": "Авторизоваться",
    "auth.logout": "Выйти",
    "auth.google": "Google",
    "auth.yandex": "Yandex",
    "profile.menuAria": "Меню профиля",
    "profile.openSettings": "Настройки пользователя",
    "profile.saveSuccess": "Профиль обновлён",
    "profile.saveError": "Не удалось обновить профиль",
    "toast.channelMoved": "Вы были отключены от голосового/видео канала: аккаунт подключился в другом месте",
    "toast.serverError": "Ошибка соединения с сервером",
    "settings.title": "Настройки пользователя",
    "settings.tabProfile": "Моя учётная запись",
    "settings.tabSound": "Звук",
    "settings.profileSection": "Профиль",
    "settings.displayName": "Отображаемое имя",
    "settings.email": "Электронная почта",
    "settings.language": "Язык интерфейса",
    "settings.save": "Сохранить",
    "settings.saving": "Сохранение...",
    "settings.soundSection": "Голос и видео",
    "settings.microphone": "Микрофон",
    "settings.speaker": "Динамик",
    "settings.inputDevice": "Устройство ввода",
    "settings.inputProfile": "Профиль ввода",
    "settings.outputDevice": "Устройство вывода",
    "settings.micVolume": "Громкость микрофона",
    "settings.outputVolume": "Громкость динамика",
    "settings.soundVolume": "Громкость звука",
    "settings.voiceSettings": "Настройки голоса",
    "settings.micTest": "Проверка микрофона",
    "settings.stopMicTest": "Остановить проверку",
    "settings.voiceIsolation": "Изоляция голоса",
    "settings.studio": "Студия",
    "settings.custom": "Пользовательский",
    "settings.showMore": "Показать больше...",
    "settings.closeVoiceAria": "Закрыть настройки",
    "settings.mediaUnavailable": "Нет доступа к аудио-устройствам.",
    "settings.browserUnsupported": "Ваш браузер не поддерживает выбор аудио-устройств.",
    "settings.devicesNotFound": "Аудио-устройства не обнаружены.",
    "settings.mediaDenied": "Доступ к микрофону/аудио запрещён в браузере.",
    "settings.devicesLoadFailed": "Не удалось получить список аудио-устройств.",
    "settings.audioInputHint": "Настройки ввода",
    "settings.outputHint": "Устройство вывода",
    "settings.refreshDevices": "Обновить устройства",
    "settings.requestMediaAccess": "Разрешить доступ к микрофону",
    "rtc.connection": "Подключение к RTC",
    "rtc.muteConnection": "Отключить соединение",
    "rtc.disconnect": "Отключиться",
    "rtc.noiseReduction": "Шумоподавление",
    "rtc.screenShare": "Демонстрация экрана",
    "rtc.effects": "Эффекты",
    "rtc.activities": "Активности",
    "rtc.connecting": "RTC: подключение",
    "rtc.connected": "RTC: подключено",
    "status.voice": "В голосовом чате",
    "status.online": "В сети",
    "audio.enableMic": "Включить микрофон",
    "audio.disableMic": "Выключить микрофон",
    "audio.enableOutput": "Включить звук",
    "audio.disableOutput": "Отключить звук",
    "rooms.title": "Каналы",
    "rooms.createCategory": "Создать категорию",
    "rooms.createChannel": "Создать канал",
    "rooms.createCategoryTitle": "Создать категорию",
    "rooms.createChannelTitle": "Создать канал",
    "rooms.categorySlug": "slug категории",
    "rooms.categoryTitle": "название категории",
    "rooms.channelSlug": "slug канала",
    "rooms.channelTitle": "название канала",
    "rooms.noCategory": "Без категории",
    "rooms.text": "Текст",
    "rooms.textVoice": "Текст + Голос",
    "rooms.textVoiceVideo": "Текст + Голос + Видео",
    "rooms.save": "Сохранить",
    "rooms.configChannel": "Настроить канал",
    "rooms.configCategory": "Настроить категорию",
    "rooms.channelSettings": "Настройки канала",
    "rooms.categorySettings": "Настройки категории",
    "rooms.up": "Вверх",
    "rooms.down": "Вниз",
    "rooms.clearChat": "Очистить чат",
    "rooms.archiveChannel": "Архивировать канал",
    "rooms.deleteChannel": "Удалить канал",
    "rooms.deleteCategory": "Удалить категорию",
    "rooms.collapseCategory": "Свернуть категорию",
    "rooms.expandCategory": "Развернуть категорию",
    "rooms.uncategorized": "Без категории",
    "rooms.hintAdmin": "Используйте иконки для создания категорий/каналов.",
    "rooms.confirmTitle": "Подтвердите действие",
    "rooms.confirmClear": "Очистить все сообщения в этом чате?",
    "rooms.confirmArchiveChannel": "Архивировать канал?",
    "rooms.confirmDeleteChannel": "Удалить канал?",
    "rooms.confirmDeleteCategory": "Удалить категорию?",
    "common.no": "Нет",
    "common.yes": "Да",
    "chat.title": "Чат",
    "chat.loadOlder": "Загрузить старые сообщения",
    "chat.loading": "Загрузка...",
    "chat.historyLoaded": "История загружена полностью",
    "chat.typePlaceholder": "Введите сообщение",
    "chat.send": "Отправить",
    "people.title": "Люди в канале",
    "people.none": "Нет подключенных пользователей.",
    "admin.title": "Админы",
    "admin.promote": "Повысить",
    "admin.demote": "Понизить",
    "admin.ban": "Забанить",
    "admin.unban": "Разбанить",
    "admin.banned": "забанен",
    "telemetry.title": "Телеметрия",
    "telemetry.day": "день",
    "telemetry.refresh": "Обновить метрики",
    "events.title": "Лог событий",
    "mobile.tabsAria": "Мобильные вкладки",
    "mobile.tabChannels": "Каналы",
    "mobile.tabChat": "Чат",
    "mobile.tabSettings": "Настройки",
    "call.title": "Голосовая комната",
    "call.status": "статус звонка",
    "call.connectRoom": "Подключиться к комнате",
    "call.disconnectRoom": "Отключиться от комнаты",
    "call.autoConnected": "Автоподключение активно",
    "call.autoWaiting": "Ожидание участников для автоподключения",
    "call.start": "Начать звонок",
    "call.pickTarget": "Выберите участника",
    "call.noTargets": "Нет доступных участников",
    "call.targetPlaceholder": "targetUserId (опционально, пусто = в комнату)",
    "call.targetRequired": "Укажите targetUserId для старта звонка",
    "call.payloadPlaceholder": "{\"type\":\"offer\",\"sdp\":\"...\"}",
    "call.offer": "Отправить offer",
    "call.answer": "Отправить answer",
    "call.ice": "Отправить ICE",
    "call.reject": "Отправить reject",
    "call.hangup": "Отправить hangup",
    "device.systemDefault": "Системное устройство"
  },
  en: {
    "app.title": "Boltorezka",
    "server.menuAria": "Server menu",
    "server.title": "Server profile",
    "server.tabUsers": "User management",
    "server.tabEvents": "Log",
    "server.tabTelemetry": "Telemetry",
    "server.tabCall": "Signaling",
    "auth.login": "Sign in",
    "auth.logout": "Logout",
    "auth.google": "Google",
    "auth.yandex": "Yandex",
    "profile.menuAria": "Profile menu",
    "profile.openSettings": "User settings",
    "profile.saveSuccess": "Profile updated",
    "profile.saveError": "Failed to update profile",
    "toast.channelMoved": "You were disconnected from voice/video channel because this account joined elsewhere",
    "toast.serverError": "Server connection error",
    "settings.title": "User Settings",
    "settings.tabProfile": "My Account",
    "settings.tabSound": "Sound",
    "settings.profileSection": "Profile",
    "settings.displayName": "Display Name",
    "settings.email": "Email",
    "settings.language": "Interface Language",
    "settings.save": "Save",
    "settings.saving": "Saving...",
    "settings.soundSection": "Voice & Video",
    "settings.microphone": "Microphone",
    "settings.speaker": "Speaker",
    "settings.inputDevice": "Input Device",
    "settings.inputProfile": "Input Profile",
    "settings.outputDevice": "Output Device",
    "settings.micVolume": "Microphone Volume",
    "settings.outputVolume": "Speaker Volume",
    "settings.soundVolume": "Output Volume",
    "settings.voiceSettings": "Voice Settings",
    "settings.micTest": "Mic Test",
    "settings.stopMicTest": "Stop Mic Test",
    "settings.voiceIsolation": "Voice Isolation",
    "settings.studio": "Studio",
    "settings.custom": "Custom",
    "settings.showMore": "Show more...",
    "settings.closeVoiceAria": "Close settings",
    "settings.mediaUnavailable": "No access to audio devices.",
    "settings.browserUnsupported": "Your browser does not support audio device selection.",
    "settings.devicesNotFound": "No audio devices found.",
    "settings.mediaDenied": "Browser denied microphone/audio access.",
    "settings.devicesLoadFailed": "Failed to enumerate audio devices.",
    "settings.audioInputHint": "Input settings",
    "settings.outputHint": "Output device",
    "settings.refreshDevices": "Refresh devices",
    "settings.requestMediaAccess": "Allow microphone access",
    "rtc.connection": "RTC Connection",
    "rtc.muteConnection": "Mute connection",
    "rtc.disconnect": "Disconnect",
    "rtc.noiseReduction": "Noise reduction",
    "rtc.screenShare": "Screen share",
    "rtc.effects": "Effects",
    "rtc.activities": "Activities",
    "rtc.connecting": "RTC: connecting",
    "rtc.connected": "RTC: connected",
    "status.voice": "In voice chat",
    "status.online": "Online",
    "audio.enableMic": "Enable microphone",
    "audio.disableMic": "Disable microphone",
    "audio.enableOutput": "Enable sound",
    "audio.disableOutput": "Mute sound",
    "rooms.title": "Rooms",
    "rooms.createCategory": "Create category",
    "rooms.createChannel": "Create channel",
    "rooms.createCategoryTitle": "Create category",
    "rooms.createChannelTitle": "Create channel",
    "rooms.categorySlug": "category slug",
    "rooms.categoryTitle": "category title",
    "rooms.channelSlug": "channel slug",
    "rooms.channelTitle": "channel title",
    "rooms.noCategory": "No category",
    "rooms.text": "Text",
    "rooms.textVoice": "Text + Voice",
    "rooms.textVoiceVideo": "Text + Voice + Video",
    "rooms.save": "Save",
    "rooms.configChannel": "Configure channel",
    "rooms.configCategory": "Configure category",
    "rooms.channelSettings": "Channel settings",
    "rooms.categorySettings": "Category settings",
    "rooms.up": "Up",
    "rooms.down": "Down",
    "rooms.clearChat": "Clear chat",
    "rooms.archiveChannel": "Archive channel",
    "rooms.deleteChannel": "Delete channel",
    "rooms.deleteCategory": "Delete category",
    "rooms.collapseCategory": "Collapse category",
    "rooms.expandCategory": "Expand category",
    "rooms.uncategorized": "Uncategorized",
    "rooms.hintAdmin": "Use icon buttons to create categories/channels.",
    "rooms.confirmTitle": "Confirm action",
    "rooms.confirmClear": "Clear all messages in this chat?",
    "rooms.confirmArchiveChannel": "Archive channel?",
    "rooms.confirmDeleteChannel": "Delete channel?",
    "rooms.confirmDeleteCategory": "Delete category?",
    "common.no": "No",
    "common.yes": "Yes",
    "chat.title": "Chat",
    "chat.loadOlder": "Load older messages",
    "chat.loading": "Loading...",
    "chat.historyLoaded": "History fully loaded",
    "chat.typePlaceholder": "Type message",
    "chat.send": "Send",
    "people.title": "People in room",
    "people.none": "No users connected.",
    "admin.title": "Admin Users",
    "admin.promote": "Promote",
    "admin.demote": "Demote",
    "admin.ban": "Ban",
    "admin.unban": "Unban",
    "admin.banned": "banned",
    "telemetry.title": "Telemetry",
    "telemetry.day": "day",
    "telemetry.refresh": "Refresh metrics",
    "events.title": "Event Log",
    "mobile.tabsAria": "Mobile tabs",
    "mobile.tabChannels": "Channels",
    "mobile.tabChat": "Chat",
    "mobile.tabSettings": "Settings",
    "call.title": "Voice room",
    "call.status": "call status",
    "call.connectRoom": "Connect room voice",
    "call.disconnectRoom": "Disconnect room voice",
    "call.autoConnected": "Auto-connect is active",
    "call.autoWaiting": "Waiting for participants to auto-connect",
    "call.start": "Start call",
    "call.pickTarget": "Select participant",
    "call.noTargets": "No available participants",
    "call.targetPlaceholder": "targetUserId (optional, empty = broadcast to room)",
    "call.targetRequired": "Specify targetUserId to start a call",
    "call.payloadPlaceholder": "{\"type\":\"offer\",\"sdp\":\"...\"}",
    "call.offer": "Send offer",
    "call.answer": "Send answer",
    "call.ice": "Send ICE",
    "call.reject": "Send reject",
    "call.hangup": "Send hangup",
    "device.systemDefault": "System default"
  }
};

export const TEXT = TEXT_BASE;

export function detectInitialLang(): Lang {
  const saved = localStorage.getItem("boltorezka_lang");
  if (saved === "ru" || saved === "en") {
    return saved;
  }

  const browser = navigator.language.toLowerCase();
  return browser.startsWith("ru") ? "ru" : "en";
}